<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https://*.gravatar.com https://*.wp.com https://*; font-src 'self'; connect-src 'self' http://localhost:* https://* ws://localhost:* wss://*; frame-src 'none'; object-src 'none'; base-uri 'self'; form-action 'none';">
  <title>설정</title>
  <link rel="stylesheet" href="settings.css">
</head>
<body>
  <div id="titlebar">
    <span class="title">설정</span>
    <button id="closeBtn">✕</button>
  </div>

  <div id="container">
    <!-- 왼쪽: 메뉴 목록 -->
    <nav id="sidebar">
      <div class="nav-item active" data-section="general">일반</div>
      <div class="nav-item" data-section="snippets">
        단축어
        <span class="nav-lock-icon" id="snippetsLock">
          <svg viewBox="0 0 512 512" fill="currentColor">
            <path d="M400,188h-36v-82c0-58-48-106-108-106S148,48,148,106v82h-36c-33,0-60,27-60,60v204c0,33,27,60,60,60h288c33,0,60-27,60-60V248C460,215,433,188,400,188z M188,106c0-36,30-66,68-66s68,30,68,66v82H188V106z"/>
          </svg>
        </span>
      </div>
      <div class="nav-item" data-section="tools">
        도구
        <span class="nav-lock-icon" id="toolsLock">
          <svg viewBox="0 0 512 512" fill="currentColor">
            <path d="M400,188h-36v-82c0-58-48-106-108-106S148,48,148,106v82h-36c-33,0-60,27-60,60v204c0,33,27,60,60,60h288c33,0,60-27,60-60V248C460,215,433,188,400,188z M188,106c0-36,30-66,68-66s68,30,68,66v82H188V106z"/>
          </svg>
        </span>
      </div>
    </nav>

    <!-- 오른쪽: 내용 -->
    <main id="content">
      <!-- 단축어 섹션 -->
      <div class="section" id="section-snippets">
        <!-- 로그인 필요 오버레이 -->
        <div class="login-required-overlay" id="snippetsOverlay">
          <div class="login-required-content">
            <svg viewBox="0 0 512 512" fill="currentColor" class="lock-icon-large">
              <path d="M400,188h-36v-82c0-58-48-106-108-106S148,48,148,106v82h-36c-33,0-60,27-60,60v204c0,33,27,60,60,60h288c33,0,60-27,60-60V248C460,215,433,188,400,188z M188,106c0-36,30-66,68-66s68,30,68,66v82H188V106z"/>
            </svg>
            <p>로그인이 필요합니다</p>
            <button type="button" class="btn-login-overlay" id="snippetsLoginBtn">로그인</button>
          </div>
        </div>
        <!-- 단축어 목록 -->
        <div id="snippetList"></div>

        <!-- 단축어 추가/수정 폼 (기본 숨김) -->
        <div id="snippetForm" class="snippet-form hidden">
          <div class="form-row">
            <label>도구</label>
            <!-- 커스텀 드롭다운 (이미지 아이콘 지원) -->
            <div class="custom-select" id="snippetToolSelect">
              <div class="custom-select-trigger">
                <span class="selected-icon"></span>
                <span class="selected-text">도구 선택</span>
                <span class="select-arrow">▼</span>
              </div>
              <div class="custom-select-options">
                <!-- 동적으로 채워짐 -->
              </div>
            </div>
            <input type="hidden" id="snippetToolValue">
          </div>
          <div class="form-row">
            <label>단축어</label>
            <input type="text" id="snippetShortcut" placeholder="예: 슬랙알림">
          </div>

          <!-- 도구별 동적 폼 필드 -->
          <div id="dynamicFields"></div>

          <div class="form-actions">
            <button type="button" id="snippetCancel" class="btn-cancel">취소</button>
            <button type="button" id="snippetSave" class="btn-save">저장</button>
          </div>
          <input type="hidden" id="snippetEditId">
        </div>

        <!-- 추가 버튼 -->
        <button class="add-btn" id="addSnippetBtn">+ 단축어 추가</button>
      </div>

      <!-- 도구 섹션 -->
      <div class="section" id="section-tools">
        <!-- 로그인 필요 오버레이 -->
        <div class="login-required-overlay" id="toolsOverlay">
          <div class="login-required-content">
            <svg viewBox="0 0 512 512" fill="currentColor" class="lock-icon-large">
              <path d="M400,188h-36v-82c0-58-48-106-108-106S148,48,148,106v82h-36c-33,0-60,27-60,60v204c0,33,27,60,60,60h288c33,0,60-27,60-60V248C460,215,433,188,400,188z M188,106c0-36,30-66,68-66s68,30,68,66v82H188V106z"/>
            </svg>
            <p>로그인이 필요합니다</p>
            <button type="button" class="btn-login-overlay" id="toolsLoginBtn">로그인</button>
          </div>
        </div>
        <!-- 도구 목록 페이지 -->
        <div id="toolsListPage" class="tools-page hidden">
          <button class="back-btn" id="backFromTools">← 뒤로</button>
          <div class="tools-list" id="availableToolsList"></div>
        </div>

        <!-- 기본 도구 설정 페이지 -->
        <div id="toolsMainPage" class="tools-page">
          <button class="tool-add-btn" id="openToolsListBtn">+ 도구 추가</button>

          <div class="option no-border">
            <label>
              <span>시작 시 자동 실행</span>
              <input type="checkbox" id="autoLaunch">
            </label>
          </div>

          <div class="option no-border">
            <label>
              <span>알림 활성화</span>
              <input type="checkbox" id="notificationEnabled">
            </label>
          </div>

          <div class="option" id="cloudSyncOption">
            <label>
              <span class="option-label-with-tag">
                클라우드 동기화
                <span class="pro-tag" id="cloudSyncProTag">Pro</span>
              </span>
              <span class="toggle-wrapper">
                <input type="checkbox" id="cloudSyncEnabled">
                <span class="toggle-lock-overlay" id="cloudSyncLock">
                  <svg viewBox="0 0 512 512" fill="currentColor">
                    <path d="M400,188h-36v-82c0-58-48-106-108-106S148,48,148,106v82h-36c-33,0-60,27-60,60v204c0,33,27,60,60,60h288c33,0,60-27,60-60V248C460,215,433,188,400,188z M188,106c0-36,30-66,68-66s68,30,68,66v82H188V106z"/>
                  </svg>
                </span>
              </span>
            </label>
          </div>

          <div class="shortcut-group">
          <div class="shortcut-row">
            <label>새 메모</label>
            <input type="text" id="newMemoShortcutInput" class="shortcut-input" readonly placeholder="클릭 후 단축키 입력">
          </div>
          <div class="shortcut-row">
            <label>열기</label>
            <input type="text" id="shortcutInput" class="shortcut-input" readonly placeholder="클릭 후 단축키 입력">
          </div>
          <div class="shortcut-row">
            <label>단축어 호출</label>
            <input type="text" id="triggerKeyInput" class="trigger-input" maxlength="1" placeholder="/">
          </div>
          <div class="shortcut-row">
            <label>단축어 실행</label>
            <input type="text" id="executeKeyInput" class="shortcut-input" readonly placeholder="Enter">
          </div>
        </div>
        </div>
      </div>

      <!-- 일반 섹션 (계정 + 정보) -->
      <div class="section active" id="section-general">
        <!-- 로그인 전 상태 -->
        <div id="loginState" class="auth-state">
          <div class="auth-message">
            <p>handsub.com 계정으로 로그인하세요</p>
            <small>로그인하면 여러 기기에서 설정을 동기화할 수 있습니다</small>
          </div>
          <button type="button" id="loginBtn" class="btn-login">로그인하기</button>
        </div>

        <!-- 로그인됨 상태 -->
        <div id="loggedInState" class="auth-state hidden">
          <!-- 사용자 프로필 -->
          <div class="user-profile" id="userProfile">
            <img src="" alt="프로필" class="profile-avatar" id="userAvatar">
            <div class="profile-info">
              <span class="profile-name" id="userName">사용자</span>
              <span class="profile-email" id="userEmail">-</span>
            </div>
            <button type="button" id="upgradeBtn" class="btn-upgrade-inline hidden">업그레이드</button>
            <div class="tier-badge" id="tierBadge">
              <span id="tierText">FREE</span>
            </div>
          </div>

          <div class="auth-actions">
            <button type="button" id="logoutBtn" class="btn-logout">로그아웃</button>
          </div>
        </div>

        <!-- 버전 정보 (하단) -->
        <div class="version-footer">
          <span>버전</span>
          <span class="version" id="versionText">-</span>
          <button id="checkUpdateBtn" class="check-update-btn hidden">업데이트</button>
        </div>

        <!-- 업데이트 가능 알림 -->
        <div id="updateAvailable" class="update-available hidden">
          <div class="update-info">
            <span class="update-badge">새 버전</span>
            <span id="latestVersionText">-</span>
          </div>
          <button id="downloadUpdateBtn" class="download-update-btn">업데이트</button>
        </div>

        <!-- 다운로드 진행 중 -->
        <div id="updateDownloading" class="update-downloading hidden">
          <div class="download-info">
            <span>다운로드 중...</span>
            <span id="downloadPercent">0%</span>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
          </div>
        </div>

        <!-- 다운로드 완료 - 재시작 -->
        <div id="updateReady" class="update-ready hidden">
          <div class="update-info">
            <span class="update-badge ready">준비 완료</span>
            <span>재시작하여 업데이트 적용</span>
          </div>
          <button id="restartBtn" class="restart-btn">지금 재시작</button>
        </div>
      </div>
    </main>
  </div>

  <!-- 확인 모달 -->
  <div id="confirmModal" class="confirm-modal hidden">
    <div class="confirm-modal-backdrop"></div>
    <div class="confirm-modal-content">
      <p id="confirmModalMessage">로그아웃하시겠습니까?</p>
      <div class="confirm-modal-actions">
        <button id="confirmModalCancel" class="confirm-btn cancel">취소</button>
        <button id="confirmModalOk" class="confirm-btn ok">확인</button>
      </div>
    </div>
  </div>

  <script src="settings-renderer.js"></script>
</body>
</html>
